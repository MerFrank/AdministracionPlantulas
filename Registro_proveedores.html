<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Registro de Proveedores</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .table-responsive {
      margin-top: 20px;
    }
    .table th {
      background-color: #f8f9fa;
    }
    .section-title {
      border-bottom: 1px solid #dee2e6;
      padding-bottom: 8px;
      margin: 20px 0 15px;
      color: #2c3e50;
    }
    .optional-badge {
      font-size: 0.75rem;
      background-color: #e9ecef;
      color: #6c757d;
    }
    .action-buttons {
      white-space: nowrap;
    }
    .search-container {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="contenedor-pagina">
    <header>
      <div class="encabezado">
        <a class="navbar-brand" href="#">
          <img src="../logoplantulas.png" alt="Logo" width="130" height="124" class="d-inline-block align-text-center" />
        </a>
        <div>
          <h2>Registro de Proveedores</h2>
          <p>Ingresa un nuevo proveedor en el sistema</p>
        </div>
      </div>

      <div class="barra-navegacion">
        <nav class="navbar bg-body-tertiary">
          <div class="container-fluid">
            <div class="Opciones-barra">
              <button onclick="window.location.href='indexPlantilla.html'">
                Regresar inicio
              </button>
            </div>
          </div>
        </nav>
      </div>
    </header>

    <main>
      <div class="container mt-5">
        <form id="proveedorForm">
          <input type="hidden" id="proveedorIndex" value="-1">
          <h5 class="section-title">Información Básica</h5>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="nombreProveedor" class="form-label">Nombre/Razón Social <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="nombreProveedor" required>
            </div>
            <div class="col-md-6">
              <label for="rfc" class="form-label">RFC</label>
              <input type="text" class="form-control" id="rfc" maxlength="13">
            </div>
          </div>

          <div class="row g-3 mt-2">
            <div class="col-md-6">
              <label for="contacto" class="form-label">Persona de Contacto</label>
              <input type="text" class="form-control" id="contacto">
            </div>
            <div class="col-md-6">
              <label for="telefono" class="form-label">Teléfono <span class="text-danger">*</span></label>
              <input type="tel" class="form-control" id="telefono" required>
            </div>
          </div>

          <div class="row g-3 mt-2">
            <div class="col-md-6">
              <label for="email" class="form-label">Correo Electrónico</label>
              <input type="email" class="form-control" id="email">
            </div>
            <div class="col-md-6">
              <label for="productos" class="form-label">Productos que provee</label>
              <input type="text" class="form-control" id="productos">
            </div>
          </div>

          <h5 class="section-title">Dirección <span class="optional-badge">Opcional</span></h5>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="calle" class="form-label">Calle y Número</label>
              <input type="text" class="form-control" id="calle">
            </div>
            <div class="col-md-6">
              <label for="colonia" class="form-label">Colonia</label>
              <input type="text" class="form-control" id="colonia">
            </div>
          </div>

          <div class="row g-3 mt-2">
            <div class="col-md-4">
              <label for="ciudad" class="form-label">Ciudad</label>
              <input type="text" class="form-control" id="ciudad">
            </div>
            <div class="col-md-4">
              <label for="estado" class="form-label">Estado</label>
              <input type="text" class="form-control" id="estado">
            </div>
            <div class="col-md-4">
              <label for="cp" class="form-label">Código Postal</label>
              <input type="text" class="form-control" id="cp">
            </div>
          </div>

          <h5 class="section-title">Datos de Pago <span class="optional-badge">Opcional</span></h5>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="banco" class="form-label">Banco</label>
              <input type="text" class="form-control" id="banco">
            </div>
            <div class="col-md-6">
              <label for="cuenta" class="form-label">Número de Cuenta</label>
              <input type="text" class="form-control" id="cuenta">
            </div>
          </div>

          <div class="row g-3 mt-2">
            <div class="col-md-6">
              <label for="clabe" class="form-label">CLABE Interbancaria</label>
              <input type="text" class="form-control" id="clabe" maxlength="18">
            </div>
            <div class="col-md-6">
              <label for="metodoPago" class="form-label">Método de Pago Preferido</label>
              <select class="form-select" id="metodoPago">
                <option value="">Seleccionar...</option>
                <option value="transferencia">Transferencia electrónica</option>
                <option value="cheque">Cheque</option>
                <option value="efectivo">Efectivo</option>
                <option value="otro">Otro</option>
              </select>
            </div>
          </div>

          <div class="mt-4">
            <button type="submit" class="btn btn-success" id="submitButton">Guardar Proveedor</button>
            <button type="button" class="btn btn-secondary" id="cancelButton" style="display: none;">Cancelar</button>
          </div>
        </form>

        <div class="mt-5">
          <h5>Proveedores Registrados</h5>
          
          <!-- Filtro de búsqueda -->
          <div class="search-container">
            <div class="input-group mb-3">
              <input type="text" id="searchInput" class="form-control" placeholder="Buscar proveedor..." aria-label="Buscar proveedor">
              <button class="btn btn-outline-secondary" type="button" id="searchButton">Buscar</button>
              <button class="btn btn-outline-danger" type="button" id="clearSearch" style="display: none;">Limpiar</button>
            </div>
          </div>
          
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Contacto</th>
                  <th>Teléfono</th>
                  <th>Productos</th>
                  <th>Ciudad</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="listaProveedores">
                <tr>
                  <td colspan="6" class="text-center">No hay proveedores registrados</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <script>
        // Base de datos de ejemplo
        let proveedores = [
          {
            nombre: "Viveros Santa María",
            rfc: "VSM120405ABC",
            contacto: "Juan Pérez",
            telefono: "5512345678",
            email: "contacto@viverossantamaria.com",
            productos: "Plantas ornamentales",
            direccion: {
              calle: "Av. Principal #123",
              colonia: "Centro",
              ciudad: "Ciudad de México",
              estado: "CDMX",
              cp: "06000"
            },
            pago: {
              banco: "Banco Ejemplo",
              cuenta: "1234567890",
              clabe: "012345678901234567",
              metodo: "transferencia"
            }
          }
        ];

        // Función para verificar si el proveedor ya existe
        function proveedorExistente(nombre, rfc, indiceExcluir = -1) {
          return proveedores.some((proveedor, index) => {
            if (index === indiceExcluir) return false;
            
            // Comparar nombre (case insensitive) y RFC (si existe)
            const mismoNombre = proveedor.nombre.toLowerCase() === nombre.toLowerCase();
            const mismoRFC = rfc && proveedor.rfc && proveedor.rfc.toLowerCase() === rfc.toLowerCase();
            
            return mismoNombre || mismoRFC;
          });
        }

        // Declarar las funciones en el ámbito global
        function editarProveedor(index) {
          const proveedor = proveedores[index];
          
          document.getElementById('nombreProveedor').value = proveedor.nombre || '';
          document.getElementById('rfc').value = proveedor.rfc || '';
          document.getElementById('contacto').value = proveedor.contacto || '';
          document.getElementById('telefono').value = proveedor.telefono || '';
          document.getElementById('email').value = proveedor.email || '';
          document.getElementById('productos').value = proveedor.productos || '';
          
          // Dirección
          document.getElementById('calle').value = proveedor.direccion?.calle || '';
          document.getElementById('colonia').value = proveedor.direccion?.colonia || '';
          document.getElementById('ciudad').value = proveedor.direccion?.ciudad || '';
          document.getElementById('estado').value = proveedor.direccion?.estado || '';
          document.getElementById('cp').value = proveedor.direccion?.cp || '';
          
          // Datos de pago
          document.getElementById('banco').value = proveedor.pago?.banco || '';
          document.getElementById('cuenta').value = proveedor.pago?.cuenta || '';
          document.getElementById('clabe').value = proveedor.pago?.clabe || '';
          document.getElementById('metodoPago').value = proveedor.pago?.metodo || '';
          
          // Configurar para actualización
          document.getElementById('proveedorIndex').value = index;
          document.getElementById('submitButton').textContent = "Actualizar Proveedor";
          document.getElementById('cancelButton').style.display = "inline-block";
          
          // Scroll al formulario para mejor experiencia
          document.getElementById('proveedorForm').scrollIntoView({ behavior: 'smooth' });
        }

        function eliminarProveedor(index) {
          if (confirm('¿Está seguro que desea eliminar este proveedor?')) {
            proveedores.splice(index, 1);
            actualizarListaProveedores();
            alert('Proveedor eliminado exitosamente');
            
            // Si estaba editando el proveedor eliminado, limpiar el formulario
            if (parseInt(document.getElementById('proveedorIndex').value) === index) {
              document.getElementById('proveedorForm').reset();
              document.getElementById('proveedorIndex').value = "-1";
              document.getElementById('submitButton').textContent = "Guardar Proveedor";
              document.getElementById('cancelButton').style.display = "none";
            }
          }
        }

        function actualizarListaProveedores(filterText = '') {
          const listaProveedores = document.getElementById('listaProveedores');
          listaProveedores.innerHTML = '';
          
          let proveedoresFiltrados = proveedores;
          
          if (filterText) {
            const searchTerm = filterText.toLowerCase();
            proveedoresFiltrados = proveedores.filter(proveedor => 
              proveedor.nombre.toLowerCase().includes(searchTerm) ||
              (proveedor.contacto && proveedor.contacto.toLowerCase().includes(searchTerm)) ||
              proveedor.telefono.toLowerCase().includes(searchTerm) ||
              (proveedor.productos && proveedor.productos.toLowerCase().includes(searchTerm)) ||
              (proveedor.direccion?.ciudad && proveedor.direccion.ciudad.toLowerCase().includes(searchTerm))
            );
          }
          
          if (proveedoresFiltrados.length === 0) {
            listaProveedores.innerHTML = `
              <tr>
                <td colspan="6" class="text-center">No hay proveedores registrados</td>
              </tr>
            `;
            return;
          }

          proveedoresFiltrados.forEach((proveedor, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${proveedor.nombre}</td>
              <td>${proveedor.contacto || '-'}</td>
              <td>${proveedor.telefono}</td>
              <td>${proveedor.productos || '-'}</td>
              <td>${proveedor.direccion?.ciudad || '-'}</td>
              <td class="action-buttons">
                <button class="btn btn-sm btn-primary" onclick="editarProveedor(${index})">Editar</button>
                <button class="btn btn-sm btn-danger" onclick="eliminarProveedor(${index})">Eliminar</button>
              </td>
            `;
            listaProveedores.appendChild(row);
          });
        }

        document.addEventListener('DOMContentLoaded', function() {
          const form = document.getElementById('proveedorForm');
          const searchInput = document.getElementById('searchInput');
          const searchButton = document.getElementById('searchButton');
          const clearSearch = document.getElementById('clearSearch');
          const submitButton = document.getElementById('submitButton');
          const cancelButton = document.getElementById('cancelButton');

          // Mostrar proveedores al cargar la página
          actualizarListaProveedores();

          // Guardar nuevo proveedor o actualizar existente
          form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nombre = document.getElementById('nombreProveedor').value.trim();
            const rfc = document.getElementById('rfc').value.trim();
            const proveedorIndex = parseInt(document.getElementById('proveedorIndex').value);
            
            // Validar campos obligatorios
            if (!nombre || !document.getElementById('telefono').value.trim()) {
              alert('Por favor complete los campos obligatorios');
              return;
            }
            
            // Validar proveedor duplicado (excepto cuando se está editando el mismo)
            if (proveedorExistente(nombre, rfc, proveedorIndex)) {
              alert('Ya existe un proveedor con el mismo nombre o RFC');
              return;
            }

            const nuevoProveedor = {
              nombre: nombre,
              rfc: rfc,
              contacto: document.getElementById('contacto').value.trim(),
              telefono: document.getElementById('telefono').value.trim(),
              email: document.getElementById('email').value.trim(),
              productos: document.getElementById('productos').value.trim(),
              direccion: {
                calle: document.getElementById('calle').value.trim(),
                colonia: document.getElementById('colonia').value.trim(),
                ciudad: document.getElementById('ciudad').value.trim(),
                estado: document.getElementById('estado').value.trim(),
                cp: document.getElementById('cp').value.trim()
              },
              pago: {
                banco: document.getElementById('banco').value.trim(),
                cuenta: document.getElementById('cuenta').value.trim(),
                clabe: document.getElementById('clabe').value.trim(),
                metodo: document.getElementById('metodoPago').value
              }
            };
            
            if (proveedorIndex >= 0) {
              // Actualizar proveedor existente
              proveedores[proveedorIndex] = nuevoProveedor;
              alert('Proveedor actualizado exitosamente');
            } else {
              // Agregar nuevo proveedor
              proveedores.push(nuevoProveedor);
              alert('Proveedor registrado exitosamente');
            }
            
            // Actualizar la tabla
            actualizarListaProveedores();
            
            // Limpiar formulario
            form.reset();
            document.getElementById('proveedorIndex').value = "-1";
            submitButton.textContent = "Guardar Proveedor";
            cancelButton.style.display = "none";
          });

          // Cancelar edición
          cancelButton.addEventListener('click', function() {
            form.reset();
            document.getElementById('proveedorIndex').value = "-1";
            submitButton.textContent = "Guardar Proveedor";
            cancelButton.style.display = "none";
          });

          // Función de búsqueda
          searchButton.addEventListener('click', function() {
            const searchTerm = searchInput.value.trim();
            if (searchTerm) {
              actualizarListaProveedores(searchTerm);
              clearSearch.style.display = "inline-block";
            }
          });

          // Limpiar búsqueda
          clearSearch.addEventListener('click', function() {
            searchInput.value = '';
            actualizarListaProveedores();
            clearSearch.style.display = "none";
          });

          // Buscar al presionar Enter
          searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
              searchButton.click();
            }
          });
        });
      </script>
    </main>

    <footer>
      <p>&copy; 2025 PLANTAS AGRODEX. Todos los derechos reservados.</p>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>